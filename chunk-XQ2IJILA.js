import{b as U,c as W}from"./chunk-EUDSBLJA.js";import"./chunk-DJ7TZV7F.js";import{a as j,d as A,g as E,i as H,m as G}from"./chunk-KFPUJXAU.js";import{A as x,Ab as C,Bb as c,Cb as O,D as b,Db as u,Ga as o,Gb as D,Hb as N,Hc as V,Ib as R,Ka as w,M as v,Qa as F,Ua as p,db as s,dc as T,ec as $,fa as M,ga as P,gc as B,hb as r,hc as z,ib as a,jb as L,kb as f,lb as h,n as I,nb as S,o as k,pb as y,qb as m}from"./chunk-HMJISF6U.js";import{c as g}from"./chunk-576YX7J7.js";function J(i,t){if(i&1){let e=S();f(0),r(1,"button",13),y("click",function(){M(e);let l=m().$implicit,d=m(3);return P(d.toggleLikeRoute(l))}),c(2),a(),h()}if(i&2){let e=m().$implicit,n=m(3);o(),s("disabled",e.userEmail===n.userEmail),o(),u(" ",n.isLikedByMe(e)?"Unlike":"Like"," ")}}function K(i,t){i&1&&(r(0,"div"),c(1,"*To like routes log in or register"),a())}function Q(i,t){if(i&1){let e=S();r(0,"div",10)(1,"p"),c(2),a(),r(3,"p"),c(4),a(),r(5,"p"),c(6),a(),r(7,"p"),c(8),a(),r(9,"p"),c(10),a(),p(11,J,3,2,"ng-container",8)(12,K,2,0,"ng-template",null,1,R),r(14,"div",11)(15,"app-climbing-wall",12,2),y("wallLoaded",function(){let l=M(e).$implicit,d=C(16),_=m(3);return P(_.onClimbingWallLoaded(l,d))}),a()()()}if(i&2){let e=t.$implicit,n=C(13),l=m(3);o(2),O(e.title),o(2),O(e.description),o(2),u("Made by: ",e.userEmail,""),o(2),u("Grade: ",e.grade,""),o(2),u("Route Likes: ",e.likes,""),o(),s("ngIf",l.userEmail!==null)("ngIfElse",n),o(4),s("wall",l.wallData)("routeID",e.id)}}function X(i,t){if(i&1&&(f(0),p(1,Q,17,9,"div",9),h()),i&2){let e=m().ngIf,n=m();o(),s("ngForOf",e)("ngForTrackBy",n.trackById)}}function Y(i,t){i&1&&(r(0,"div"),c(1,"No routes found."),a())}function Z(i,t){if(i&1&&(f(0),p(1,X,2,2,"ng-container",8)(2,Y,2,0,"ng-template",null,0,R),h()),i&2){let e=t.ngIf,n=C(3);o(),s("ngIf",e.length>0)("ngIfElse",n)}}var q=class i{constructor(t,e){this.routeManagmentService=t;this.userManagmentService=e;this.holdStateDict=new Map([["start-hold",16711680],["hold",16776960],["end-hold",65280],["default-hold",9849600],["select-hold",255]]),e.isLoggedIn()?(this.userEmail=localStorage.getItem("userEmail"),this.userName=localStorage.getItem("userName")):(this.userEmail=null,this.userName=null),window.addEventListener("online",this.syncPendingLikes.bind(this))}userEmail;userName;titleFilter=new E("");gradeFilter=new E("");filteredRoutes$;wallData={width:50,height:60};routes$;holdStateDict;ngOnInit(){return g(this,null,function*(){this.routes$=this.routeManagmentService.getAllRoutesObs();let t=this.titleFilter.valueChanges.pipe(v(""),x(200),b()),e=this.gradeFilter.valueChanges.pipe(v(""),x(200),b());this.filteredRoutes$=k([this.routes$,t,e]).pipe(I(([n,l,d])=>n.filter(_=>(l?_.title.toLowerCase().includes(l.toLowerCase()):!0)&&(d?_.grade?.toLowerCase().includes(d.toLowerCase()):!0))))})}trackById(t,e){return e.id}toggleLikeRoute(t){return g(this,null,function*(){this.userEmail&&(yield this.routeManagmentService.toggleLikeRoute(t,this.userEmail))})}syncPendingLikes(){return g(this,null,function*(){yield this.routeManagmentService.syncPendingLikes(this.routes$)})}isLikedByMe(t){return this.userEmail?(t.likedBy??[]).includes(this.userEmail):!1}getUserNameByEmail(t){return g(this,null,function*(){return(yield this.userManagmentService.readUserNameByEmail(t))||t})}onClimbingWallLoaded(t,e){for(let n=0;n<t.holds.length;n++){e.setHoldRotation(t.holds[n].posID,t.holds[n].angle);let l=this.holdStateDict.get(t.holds[n].state);l!==void 0&&e.setHoldState(t.holds[n].posID,l)}}static \u0275fac=function(e){return new(e||i)(w(W),w(V))};static \u0275cmp=F({type:i,selectors:[["app-route-search-page"]],decls:8,vars:5,consts:[["noRoutes",""],["notLoggedIn",""],["climbingWall",""],[1,"route-search-bar"],["type","text","placeholder","Search by title...",3,"formControl"],["type","text","placeholder","Search by grade...",3,"formControl"],[1,"holder"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["class","route-card",4,"ngFor","ngForOf","ngForTrackBy"],[1,"route-card"],[1,"climbing-wall-container",2,"width","100%","height","400px"],[3,"wallLoaded","wall","routeID"],[3,"click","disabled"]],template:function(e,n){e&1&&(r(0,"h1"),c(1,"Route Search"),a(),r(2,"div",3),L(3,"input",4)(4,"input",5),a(),r(5,"div",6),p(6,Z,4,2,"ng-container",7),D(7,"async"),a()),e&2&&(o(3),s("formControl",n.titleFilter),o(),s("formControl",n.gradeFilter),o(2),s("ngIf",N(7,3,n.filteredRoutes$)))},dependencies:[U,z,T,$,B,G,j,A,H],styles:["h1[_ngcontent-%COMP%]{text-align:center;font-weight:600;letter-spacing:.05em;margin-top:2rem;margin-bottom:2.5rem;font-size:2.2rem;color:#2d384b}.route-search-bar[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1.2rem;margin-bottom:1.8rem}.route-search-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{padding:.75em 1em;border-radius:8px;border:1.5px solid #c3cbe0;background:#f5f8fc;font-size:1.05rem;min-width:220px;transition:border-color .18s}.route-search-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus{border-color:#294686;outline:none;background:#fff}.holder[_ngcontent-%COMP%]{max-width:720px;margin:0 auto 3rem;padding:0 1rem}.route-card[_ngcontent-%COMP%]{background:#fff;margin-bottom:2.5rem;border-radius:14px;box-shadow:0 8px 32px #3c485333,0 1.5px 6px #20232733;padding:2rem 2.25rem 1.5rem;display:flex;flex-direction:column;gap:.85rem;position:relative;transition:box-shadow .15s}.route-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:#2d384b;word-break:break-word}.route-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{font-weight:600;font-size:1.2rem;color:#294686;margin-bottom:.3rem}.route-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(3), .route-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(4){opacity:.74;font-size:.98rem}.route-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{align-self:flex-start;padding:.6em 1.25em;font-size:1rem;font-weight:600;color:#294686;border:1.7px solid #294686;border-radius:7px;margin-top:.7rem;background:#f3f5fd;cursor:pointer;transition:background .18s,color .18s}.route-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:enabled, .route-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus:enabled{background:#294686;color:#fff}.route-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.46;cursor:not-allowed;background:#f7f9ff;color:#888ea8}.route-card[_ngcontent-%COMP%]   .climbing-wall-container[_ngcontent-%COMP%]{margin-top:1.35rem;border-radius:10px;overflow:hidden;background:#eff3fa;box-shadow:0 2px 18px #2857c60a}[ng-template][_ngcontent-%COMP%], .no-routes[_ngcontent-%COMP%], .login-notice[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:120px;color:#585870;font-size:1.12rem;opacity:.84}@media (max-width: 600px){.route-card[_ngcontent-%COMP%]{padding:1.1rem .7rem 1rem}.holder[_ngcontent-%COMP%]{padding:0 .3rem}h1[_ngcontent-%COMP%]{font-size:1.32rem}.route-search-bar[_ngcontent-%COMP%]{flex-direction:column;justify-content:center;align-items:center}.route-search-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{min-width:0;width:80%;font-size:.9rem}}"]})};export{q as RouteSearchPageComponent};
