import{b as U,c as W}from"./chunk-VNDCGUNK.js";import"./chunk-JGCTVKLB.js";import{a as j,d as A,g as E,i as H,m as q}from"./chunk-32OXLRM3.js";import{A as x,Ab as m,Bb as C,Cb as O,D as b,Fb as D,Ga as o,Gb as N,Gc as V,Hb as R,Ka as w,M as v,Qa as F,Ua as p,cc as T,db as c,dc as $,fa as M,fc as B,ga as P,gc as z,hb as a,ib as l,jb as L,kb as _,lb as f,mb as S,n as I,o as k,ob as y,pb as s,zb as h}from"./chunk-H5PX2EZB.js";import{c as g}from"./chunk-576YX7J7.js";function J(i,t){if(i&1){let e=S();_(0),a(1,"button",13),y("click",function(){M(e);let r=s().$implicit,d=s(3);return P(d.toggleLikeRoute(r))}),m(2),l(),f()}if(i&2){let e=s().$implicit,n=s(3);o(),c("disabled",e.userEmail===n.userEmail),o(),O(" ",n.isLikedByMe(e)?"Unlike":"Like"," ")}}function K(i,t){i&1&&(a(0,"div"),m(1,"*To like routes log in or register"),l())}function Q(i,t){if(i&1){let e=S();a(0,"div",10)(1,"p"),m(2),l(),a(3,"p"),m(4),l(),a(5,"p"),m(6),l(),a(7,"p"),m(8),l(),p(9,J,3,2,"ng-container",8)(10,K,2,0,"ng-template",null,1,R),a(12,"div",11)(13,"app-climbing-wall",12,2),y("wallLoaded",function(){let r=M(e).$implicit,d=h(14),u=s(3);return P(u.onClimbingWallLoaded(r,d))}),l()()()}if(i&2){let e=t.$implicit,n=h(11),r=s(3);o(2),C(e.title),o(2),C(e.description),o(2),C(e.userEmail),o(2),O("Route Likes: ",e.likes,""),o(),c("ngIf",r.userEmail!==null)("ngIfElse",n),o(4),c("wall",r.wallData)("routeID",e.id)}}function X(i,t){if(i&1&&(_(0),p(1,Q,15,8,"div",9),f()),i&2){let e=s().ngIf,n=s();o(),c("ngForOf",e)("ngForTrackBy",n.trackById)}}function Y(i,t){i&1&&(a(0,"div"),m(1,"No routes found."),l())}function Z(i,t){if(i&1&&(_(0),p(1,X,2,2,"ng-container",8)(2,Y,2,0,"ng-template",null,0,R),f()),i&2){let e=t.ngIf,n=h(3);o(),c("ngIf",e.length>0)("ngIfElse",n)}}var G=class i{constructor(t,e){this.routeManagmentService=t;this.userManagmentService=e;this.holdStateDict=new Map([["start-hold",16711680],["hold",16776960],["end-hold",65280],["default-hold",9849600],["select-hold",255]]),e.isLoggedIn()?(this.userEmail=localStorage.getItem("userEmail"),this.userName=localStorage.getItem("userName")):(this.userEmail=null,this.userName=null),window.addEventListener("online",this.syncPendingLikes.bind(this))}userEmail;userName;titleFilter=new E("");gradeFilter=new E("");filteredRoutes$;wallData={width:50,height:60};routes$;holdStateDict;ngOnInit(){return g(this,null,function*(){this.routes$=this.routeManagmentService.getAllRoutesObs();let t=this.titleFilter.valueChanges.pipe(v(""),x(200),b()),e=this.gradeFilter.valueChanges.pipe(v(""),x(200),b());this.filteredRoutes$=k([this.routes$,t,e]).pipe(I(([n,r,d])=>n.filter(u=>(r?u.title.toLowerCase().includes(r.toLowerCase()):!0)&&(d?u.grade?.toLowerCase().includes(d.toLowerCase()):!0))))})}trackById(t,e){return e.id}toggleLikeRoute(t){return g(this,null,function*(){this.userEmail&&(yield this.routeManagmentService.toggleLikeRoute(t,this.userEmail))})}syncPendingLikes(){return g(this,null,function*(){yield this.routeManagmentService.syncPendingLikes(this.routes$)})}isLikedByMe(t){return this.userEmail?(t.likedBy??[]).includes(this.userEmail):!1}getUserNameByEmail(t){return g(this,null,function*(){return(yield this.userManagmentService.readUserNameByEmail(t))||t})}onClimbingWallLoaded(t,e){for(let n=0;n<t.holds.length;n++){e.setHoldRotation(t.holds[n].posID,t.holds[n].angle);let r=this.holdStateDict.get(t.holds[n].state);r!==void 0&&e.setHoldState(t.holds[n].posID,r)}}static \u0275fac=function(e){return new(e||i)(w(W),w(V))};static \u0275cmp=F({type:i,selectors:[["app-route-search-page"]],decls:8,vars:5,consts:[["noRoutes",""],["notLoggedIn",""],["climbingWall",""],[1,"route-search-bar"],["type","text","placeholder","Search by title...",3,"formControl"],["type","text","placeholder","Search by grade...",3,"formControl"],[1,"holder"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["class","route-card",4,"ngFor","ngForOf","ngForTrackBy"],[1,"route-card"],[1,"climbing-wall-container",2,"width","100%","height","400px"],[3,"wallLoaded","wall","routeID"],[3,"click","disabled"]],template:function(e,n){e&1&&(a(0,"h1"),m(1,"Route Search"),l(),a(2,"div",3),L(3,"input",4)(4,"input",5),l(),a(5,"div",6),p(6,Z,4,2,"ng-container",7),D(7,"async"),l()),e&2&&(o(3),c("formControl",n.titleFilter),o(),c("formControl",n.gradeFilter),o(2),c("ngIf",N(7,3,n.filteredRoutes$)))},dependencies:[U,z,T,$,B,q,j,A,H],styles:["h1[_ngcontent-%COMP%]{text-align:center;font-weight:600;letter-spacing:.05em;margin-top:2rem;margin-bottom:2.5rem;font-size:2.2rem;color:#2d384b}.route-search-bar[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1.2rem;margin-bottom:1.8rem}.route-search-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{padding:.75em 1em;border-radius:8px;border:1.5px solid #c3cbe0;background:#f5f8fc;font-size:1.05rem;min-width:220px;transition:border-color .18s}.route-search-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus{border-color:#294686;outline:none;background:#fff}.holder[_ngcontent-%COMP%]{max-width:720px;margin:0 auto 3rem;padding:0 1rem}.route-card[_ngcontent-%COMP%]{background:#fff;margin-bottom:2.5rem;border-radius:14px;box-shadow:0 8px 32px #3c48531c,0 1.5px 6px #20232705;padding:2rem 2.25rem 1.5rem;display:flex;flex-direction:column;gap:.85rem;position:relative;transition:box-shadow .15s}.route-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:#2d384b;word-break:break-word}.route-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{font-weight:600;font-size:1.2rem;color:#294686;margin-bottom:.3rem}.route-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(3), .route-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(4){opacity:.74;font-size:.98rem}.route-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{align-self:flex-start;padding:.6em 1.25em;font-size:1rem;font-weight:600;color:#294686;border:1.7px solid #294686;border-radius:7px;margin-top:.7rem;background:#f3f5fd;cursor:pointer;transition:background .18s,color .18s}.route-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:enabled, .route-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus:enabled{background:#294686;color:#fff}.route-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.46;cursor:not-allowed;background:#f7f9ff;color:#888ea8}.route-card[_ngcontent-%COMP%]   .climbing-wall-container[_ngcontent-%COMP%]{margin-top:1.35rem;border-radius:10px;overflow:hidden;background:#eff3fa;box-shadow:0 2px 18px #2857c60a}[ng-template][_ngcontent-%COMP%], .no-routes[_ngcontent-%COMP%], .login-notice[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:120px;color:#585870;font-size:1.12rem;opacity:.84}@media (max-width: 600px){.route-card[_ngcontent-%COMP%]{padding:1.1rem .7rem 1rem}.holder[_ngcontent-%COMP%]{padding:0 .3rem}h1[_ngcontent-%COMP%]{font-size:1.32rem}.route-search-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{min-width:0;width:100px;font-size:.9rem}}"]})};export{G as RouteSearchPageComponent};
