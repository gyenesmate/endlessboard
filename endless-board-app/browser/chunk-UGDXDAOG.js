import{a as h,b as f,c as B}from"./chunk-VNDCGUNK.js";import"./chunk-JGCTVKLB.js";import{a as z,b as W,c as j,d as q,e as Q,f as U,g as L}from"./chunk-KD6BBHMR.js";import{e as F}from"./chunk-JY2YBEA6.js";import{a as D,b as g,d as k,e as T,h as I,j as A,k as N,l as V,m as G}from"./chunk-32OXLRM3.js";import{Ab as l,Bb as O,Cb as y,Ga as s,Ka as u,Qa as C,Ua as M,cc as E,db as p,fa as _,ga as b,gc as R,hb as i,ib as n,jb as a,mb as S,ob as m,pb as x,sb as H,ub as v,vb as P,wb as w}from"./chunk-H5PX2EZB.js";import"./chunk-576YX7J7.js";function J(c,t){if(c&1){let e=S();i(0,"div")(1,"input",16),m("change",function(r){_(e);let d=x();return b(d.radioChangeHandler(r))}),n(),i(2,"i"),l(3),n()()}if(c&2){let e=t.$implicit;s(),H("value",e),s(2),O(e)}}var $=class c{constructor(t,e,o){this.formBuilder=t;this.routeManagmentService=e;this.router=o;this.holdStateDict=new Map([["start-hold",16711680],["hold",16776960],["end-hold",65280],["default-hold",9849600],["select-hold",255]]),this.states=Array.from(this.holdStateDict.keys()),this.selectedStart=0,this.selectedEnd=0,this.holdAngleValue=0,this.routeCreatingForm=this.formBuilder.group({routeTitle:["",g.required],routeDescription:["",g.required],routeGrade:["",g.required]})}routeCreatingForm;holdStateDict;holdStateMap=new Map;selectedHold=null;selectedState;states;selectedStart;selectedEnd;holdAngleValue;wallData={width:50,height:60};routeID="routeHold";climbingWallComponent;randomRouteBuilder(){let t=0;if(this.climbingWallComponent)for(let e=0;e<=48;e++)this.climbingWallComponent.setHoldRotation(e,Math.floor(Math.random()*361+0)),t++}setHoldState(t,e){t.material.color.setHex(this.holdStateDict.get(e)),this.holdStateMap.set(t,e)}getHoldState(t){return this.holdStateMap.get(t)||"default-hold"}onHoldClicked(t){if(this.selectedState===void 0){console.warn("Nothing is selected");return}let e=this.getHoldState(t);if(this.selectedState==="start-hold"&&this.selectedStart<2&&e!=="start-hold")this.setHoldState(t,"start-hold"),this.selectedStart++;else if(this.selectedState==="hold")this.setHoldState(t,"hold");else if(this.selectedState==="end-hold"&&this.selectedEnd<2&&e!=="end-hold")this.setHoldState(t,"end-hold"),this.selectedEnd++;else if(this.selectedState==="default-hold")e==="start-hold"&&this.selectedStart--,e==="end-hold"&&this.selectedEnd--,this.setHoldState(t,"default-hold");else if(this.selectedState==="select-hold"){if(this.selectedHold&&this.selectedHold!==t){let o=this.getHoldState(this.selectedHold);this.setHoldState(this.selectedHold,o==="select-hold"?this.selectedHold.__preSelectState||"default-hold":o),delete this.selectedHold.__preSelectState}t.__preSelectState=e,this.setHoldState(t,"select-hold"),this.selectedHold=t}if(this.selectedState!=="select-hold"&&this.selectedHold&&this.getHoldState(this.selectedHold)==="select-hold"){let o=this.selectedHold.__preSelectState||"default-hold";this.setHoldState(this.selectedHold,o),delete this.selectedHold.__preSelectState,this.selectedHold=null}}radioChangeHandler(t){if(this.selectedHold&&this.getHoldState(this.selectedHold)==="select-hold"){let e=this.selectedHold.__preSelectState||"default-hold";this.setHoldState(this.selectedHold,e),delete this.selectedHold.__preSelectState,this.selectedHold=null}this.selectedState=t.target.value}sliderChangeHandler(t){this.holdAngleValue=t.target.value,this.selectedState==="select-hold"&&this.selectedHold!==null&&(this.selectedHold.rotation.z=h.degToRad(this.holdAngleValue))}saveBoulder(){if(this.routeCreatingForm.valid){let t=this.climbingWallComponent.getAllMeshHolds();if(this.selectedHold&&this.getHoldState(this.selectedHold)==="select-hold"){let o=this.selectedHold.__preSelectState||"default-hold";this.setHoldState(this.selectedHold,o),delete this.selectedHold.__preSelectState,this.selectedHold=null}let e=t.map(o=>{let r=o.material.color.getHex(),d=this.getHoldStateFromColor(r,this.holdStateDict);return{posID:Number(o.name.slice(this.routeID.length)),angle:h.radToDeg(o.rotation.z),state:d}});this.routeManagmentService.createRouteInDB(this.routeCreatingForm.value.routeTitle,this.routeCreatingForm.value.routeDescription,this.routeCreatingForm.value.routeGrade,e).then(o=>{o?this.router.navigateByUrl("/main"):console.warn("Route couldt be added")})}else alert("Something is wrong")}getHoldStateFromColor(t,e){for(let[o,r]of e.entries())if(r===t)return o;return"default-hold"}static \u0275fac=function(e){return new(e||c)(u(V),u(B),u(F))};static \u0275cmp=C({type:c,selectors:[["app-route-builder-page"]],viewQuery:function(e,o){if(e&1&&v(f,5),e&2){let r;P(r=w())&&(o.climbingWallComponent=r.first)}},decls:35,vars:5,consts:[[1,"work-space"],[1,"wall-container"],[3,"emitClickedHold","wall","routeID"],[1,"toolbar"],["type","submit",2,"width","fit-content",3,"click"],[4,"ngFor","ngForOf"],[1,"slider-container"],["for","angleSlider"],["type","range","id","angleSlider","min","0","max","360","value","0",3,"input"],["id","angleDisplay"],[1,"routeAttributes"],[3,"submit","formGroup"],["matInput","","formControlName","routeTitle","type","text"],["matInput","","formControlName","routeDescription","type","text"],["matInput","","formControlName","routeGrade","type","text"],["mat-stroked-button","","type","submit"],["type","radio","name","stateSelection",3,"change","value"]],template:function(e,o){e&1&&(i(0,"h1"),l(1,"Build your own"),n(),i(2,"div",0)(3,"div",1)(4,"app-climbing-wall",2),m("emitClickedHold",function(d){return o.onHoldClicked(d)}),n()(),i(5,"div",3)(6,"button",4),m("click",function(){return o.randomRouteBuilder()}),l(7,"Random Rotation"),n(),M(8,J,4,2,"div",5),i(9,"div",6)(10,"label",7),l(11,"Hold Angle: "),n(),a(12,"br"),i(13,"input",8),m("input",function(d){return o.sliderChangeHandler(d)}),n(),i(14,"div",9),l(15),n()()(),i(16,"div",10)(17,"form",11),m("submit",function(){return o.saveBoulder()}),i(18,"mat-form-field")(19,"mat-label"),l(20,"Title"),n(),a(21,"input",12),n(),a(22,"br"),i(23,"mat-form-field")(24,"mat-label"),l(25,"Description"),n(),a(26,"input",13),n(),a(27,"br"),i(28,"mat-form-field")(29,"mat-label"),l(30,"Grade"),n(),a(31,"input",14),n(),a(32,"br"),i(33,"button",15),l(34," Save Boulder "),n()()()()),e&2&&(s(4),p("wall",o.wallData)("routeID",o.routeID),s(4),p("ngForOf",o.states),s(7),y("",o.holdAngleValue,"\xB0"),s(2),p("formGroup",o.routeCreatingForm))},dependencies:[R,E,f,G,I,D,k,T,A,N,j,W,z,Q,q,L,U],styles:["h1[_ngcontent-%COMP%]{text-align:center;font-size:2.2rem;font-weight:700;margin:2rem 0;color:#2d384b;letter-spacing:.03em}.work-space[_ngcontent-%COMP%]{display:flex;gap:2.5rem;justify-content:center;align-items:center;max-width:1200px;margin:0 auto 4rem;padding:0 1.3rem;flex-wrap:wrap}.wall-container[_ngcontent-%COMP%]{flex:1 1 420px;background:#f4f8fb;border-radius:16px;box-shadow:0 4px 22px #4664ba1a;min-width:320px;max-width:540px;height:500px;width:100%;overflow:hidden;display:flex;align-items:center;justify-content:center}.toolbar[_ngcontent-%COMP%]{flex:0 1 220px;display:flex;flex-direction:column;align-items:flex-start;background:#fff;border-radius:14px;box-shadow:0 8px 32px #3c48531a;padding:1.3rem 1.2rem 1.6rem;min-width:190px;margin-top:.5rem;gap:1.05rem}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1rem;font-weight:550;color:#294686;border-radius:6px;border:1.5px solid #294686;background:#f3f5fd;padding:.5em 1em;margin-bottom:.7rem;transition:background .16s,color .16s}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{background:#294686;color:#fff}.toolbar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:.5rem;display:flex;align-items:center;gap:.55em}.toolbar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{accent-color:#294686;margin-right:.28em}.toolbar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.98rem;color:#50618f;font-style:normal}.toolbar[_ngcontent-%COMP%]   .slider-container[_ngcontent-%COMP%]{width:100%;margin-top:1.2rem}.toolbar[_ngcontent-%COMP%]   .slider-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.07rem;font-weight:500;color:#2d384b}.toolbar[_ngcontent-%COMP%]   .slider-container[_ngcontent-%COMP%]   #angleSlider[_ngcontent-%COMP%]{width:100%;margin-top:.5rem;accent-color:#294686;height:3px;background:#e7edfa;border-radius:3px;cursor:pointer}.toolbar[_ngcontent-%COMP%]   .slider-container[_ngcontent-%COMP%]   #angleDisplay[_ngcontent-%COMP%]{margin-top:.3rem;font-size:.96rem;color:#197749;text-align:right;font-weight:500}.routeAttributes[_ngcontent-%COMP%]{flex:1 1 330px;min-width:260px;max-width:400px;margin-top:.5rem}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{background:#fff;padding:2rem 1.7rem 1.7rem;border-radius:14px;box-shadow:0 8px 32px #3c48531f,0 2.5px 6px #20232708;display:flex;flex-direction:column}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{margin-top:.8rem;padding:.6em 0;font-size:1.1rem;font-weight:600;border-radius:8px;color:#197749;border-color:#197749;transition:background .18s,color .18s;min-width:130px}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background:#197749;color:#fff}@media (max-width: 1020px){.work-space[_ngcontent-%COMP%]{flex-direction:column;gap:2rem;align-items:stretch}.wall-container[_ngcontent-%COMP%], .toolbar[_ngcontent-%COMP%], .routeAttributes[_ngcontent-%COMP%]{max-width:100%;min-width:0;width:100%}}@media (max-width: 610px){h1[_ngcontent-%COMP%]{font-size:1.33rem;margin-top:1.3rem}.work-space[_ngcontent-%COMP%]{padding:0 .1rem}.toolbar[_ngcontent-%COMP%], .routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{padding:1.1rem .6rem}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{gap:.55rem}}"]})};export{$ as RouteBuilderPageComponent};
