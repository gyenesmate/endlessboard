import{a as H,b as v,c as k}from"./chunk-EUDSBLJA.js";import"./chunk-DJ7TZV7F.js";import{a as j,b as q,c as U,d as L,e as $,f as J,g as K,h as X}from"./chunk-SCVCYGCP.js";import{e as V}from"./chunk-DIJJPSZ3.js";import{a as T,b as f,d as I,e as A,h as N,j as G,k as z,l as W,m as Q}from"./chunk-KFPUJXAU.js";import{Bb as l,Cb as R,Db as F,Ga as d,Ka as g,Ma as x,Qa as w,Ua as P,db as h,dc as B,fa as c,ga as m,hb as r,hc as D,ib as i,jb as a,mb as y,nb as _,pb as u,qb as O,tb as E,vb as b,wb as M,xb as S}from"./chunk-HMJISF6U.js";import"./chunk-576YX7J7.js";var Z=["dynamicErrorHost"];function ee(p,t){if(p&1){let e=_();r(0,"div")(1,"input",17),u("change",function(n){c(e);let s=O();return m(s.radioChangeHandler(n))}),i(),r(2,"i"),l(3),i()()}if(p&2){let e=t.$implicit;d(),E("value",e),d(2),R(e)}}var Y=class p{constructor(t,e,o){this.formBuilder=t;this.routeManagmentService=e;this.router=o;this.holdStateDict=new Map([["start-hold",16711680],["hold",16776960],["end-hold",65280],["default-hold",9849600],["select-hold",255]]),this.states=Array.from(this.holdStateDict.keys()),this.selectedStart=0,this.selectedEnd=0,this.holdAngleValue=0,this.routeCreatingForm=this.formBuilder.group({routeTitle:["",f.required],routeDescription:["",f.required],routeGrade:["",f.required]})}routeCreatingForm;container;holdStateDict;holdStateMap=new Map;selectedHold=null;selectedState;states;selectedStart;selectedEnd;holdAngleValue;wallData={width:50,height:60};routeID="routeHold";climbingWallComponent;randomRouteBuilder(){let t=0;if(this.climbingWallComponent)for(let e=0;e<=48;e++)this.climbingWallComponent.setHoldRotation(e,Math.floor(Math.random()*361+0)),t++}setHoldState(t,e){t.material.color.setHex(this.holdStateDict.get(e)),this.holdStateMap.set(t,e)}getHoldState(t){return this.holdStateMap.get(t)||"default-hold"}onHoldClicked(t){if(this.selectedState===void 0){console.warn("Nothing is selected");return}let e=this.getHoldState(t);if(this.selectedState==="start-hold"&&this.selectedStart<2&&e!=="start-hold")this.setHoldState(t,"start-hold"),this.selectedStart++;else if(this.selectedState==="hold")this.setHoldState(t,"hold");else if(this.selectedState==="end-hold"&&this.selectedEnd<2&&e!=="end-hold")this.setHoldState(t,"end-hold"),this.selectedEnd++;else if(this.selectedState==="default-hold")e==="start-hold"&&this.selectedStart--,e==="end-hold"&&this.selectedEnd--,this.setHoldState(t,"default-hold");else if(this.selectedState==="select-hold"){if(this.selectedHold&&this.selectedHold!==t){let o=this.getHoldState(this.selectedHold);this.setHoldState(this.selectedHold,o==="select-hold"?this.selectedHold.__preSelectState||"default-hold":o),delete this.selectedHold.__preSelectState}t.__preSelectState=e,this.setHoldState(t,"select-hold"),this.selectedHold=t}if(this.selectedState!=="select-hold"&&this.selectedHold&&this.getHoldState(this.selectedHold)==="select-hold"){let o=this.selectedHold.__preSelectState||"default-hold";this.setHoldState(this.selectedHold,o),delete this.selectedHold.__preSelectState,this.selectedHold=null}}radioChangeHandler(t){if(this.selectedHold&&this.getHoldState(this.selectedHold)==="select-hold"){let e=this.selectedHold.__preSelectState||"default-hold";this.setHoldState(this.selectedHold,e),delete this.selectedHold.__preSelectState,this.selectedHold=null}this.selectedState=t.target.value}sliderChangeHandler(t){this.holdAngleValue=t.target.value,this.selectedState==="select-hold"&&this.selectedHold!==null&&(this.selectedHold.rotation.z=H.degToRad(this.holdAngleValue))}saveBoulder(){if(this.routeCreatingForm.valid){let t=this.climbingWallComponent.getAllMeshHolds();if(this.selectedHold&&this.getHoldState(this.selectedHold)==="select-hold"){let o=this.selectedHold.__preSelectState||"default-hold";this.setHoldState(this.selectedHold,o),delete this.selectedHold.__preSelectState,this.selectedHold=null}let e=t.map(o=>{let n=o.material.color.getHex(),s=this.getHoldStateFromColor(n,this.holdStateDict);return{posID:Number(o.name.slice(this.routeID.length)),angle:H.radToDeg(o.rotation.z),state:s}});this.routeManagmentService.createRouteInDB(this.routeCreatingForm.value.routeTitle,this.routeCreatingForm.value.routeDescription,this.routeCreatingForm.value.routeGrade,e).then(o=>{o?this.router.navigateByUrl("/main"):this.showErrorMessage("Failed to save the route. Please try again.")})}else this.showErrorMessage("Please fill in all route details before saving.")}getHoldStateFromColor(t,e){for(let[o,n]of e.entries())if(n===t)return o;return"default-hold"}showErrorMessage(t){this.container.clear();let e=this.container.createComponent(X);e.instance.message=t}static \u0275fac=function(e){return new(e||p)(g(W),g(k),g(V))};static \u0275cmp=w({type:p,selectors:[["app-route-builder-page"]],viewQuery:function(e,o){if(e&1&&(b(Z,5,x),b(v,5)),e&2){let n;M(n=S())&&(o.container=n.first),M(n=S())&&(o.climbingWallComponent=n.first)}},decls:37,vars:5,consts:[["dynamicErrorHost",""],[1,"work-space"],[1,"wall-container"],[3,"emitClickedHold","wall","routeID"],[1,"toolbar"],["type","submit",2,"width","fit-content",3,"click"],[4,"ngFor","ngForOf"],[1,"slider-container"],["for","angleSlider"],["type","range","id","angleSlider","min","0","max","360","value","0",3,"input"],["id","angleDisplay"],[1,"routeAttributes"],[3,"submit","formGroup"],["matInput","","formControlName","routeTitle","type","text"],["matInput","","formControlName","routeDescription","type","text"],["matInput","","formControlName","routeGrade","type","text"],["mat-stroked-button","","type","submit"],["type","radio","name","stateSelection",3,"change","value"]],template:function(e,o){if(e&1){let n=_();r(0,"h1"),l(1,"Build your own"),i(),r(2,"div",1)(3,"div",2)(4,"app-climbing-wall",3),u("emitClickedHold",function(C){return c(n),m(o.onHoldClicked(C))}),i()(),r(5,"div",4)(6,"button",5),u("click",function(){return c(n),m(o.randomRouteBuilder())}),l(7,"Random Rotation"),i(),P(8,ee,4,2,"div",6),r(9,"div",7)(10,"label",8),l(11,"Hold Angle: "),i(),a(12,"br"),r(13,"input",9),u("input",function(C){return c(n),m(o.sliderChangeHandler(C))}),i(),r(14,"div",10),l(15),i()()(),r(16,"div",11)(17,"form",12),u("submit",function(){return c(n),m(o.saveBoulder())}),r(18,"mat-form-field")(19,"mat-label"),l(20,"Title"),i(),a(21,"input",13),i(),a(22,"br"),r(23,"mat-form-field")(24,"mat-label"),l(25,"Description"),i(),a(26,"input",14),i(),a(27,"br"),r(28,"mat-form-field")(29,"mat-label"),l(30,"Grade"),i(),a(31,"input",15),i(),a(32,"br"),r(33,"button",16),l(34," Save Boulder "),i()()()(),y(35,null,0)}e&2&&(d(4),h("wall",o.wallData)("routeID",o.routeID),d(4),h("ngForOf",o.states),d(7),F("",o.holdAngleValue,"\xB0"),d(2),h("formGroup",o.routeCreatingForm))},dependencies:[D,B,v,Q,N,T,I,A,G,z,U,q,j,$,L,K,J],styles:["h1[_ngcontent-%COMP%]{text-align:center;font-size:2.2rem;font-weight:700;margin:2rem 0;color:#2d384b;letter-spacing:.03em}.work-space[_ngcontent-%COMP%]{display:flex;gap:2.5rem;justify-content:center;align-items:center;max-width:1200px;margin:0 auto 4rem;padding:0 1.3rem;flex-wrap:wrap}.wall-container[_ngcontent-%COMP%]{flex:1 1 420px;background:#f4f8fb;border-radius:16px;box-shadow:0 4px 22px #4664ba33;min-width:320px;max-width:540px;height:500px;width:100%;overflow:hidden;display:flex;align-items:center;justify-content:center}.toolbar[_ngcontent-%COMP%]{flex:0 1 220px;display:flex;flex-direction:column;align-items:flex-start;background:#fff;border-radius:14px;box-shadow:0 8px 32px #3c485333;padding:1.3rem 1.2rem 1.6rem;min-width:190px;margin-top:.5rem;gap:1.05rem}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1rem;font-weight:550;color:#294686;border-radius:6px;border:1.5px solid #294686;background:#f3f5fd;padding:.5em 1em;margin-bottom:.7rem;transition:background .16s,color .16s}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{background:#294686;color:#fff}.toolbar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:.5rem;display:flex;align-items:center;gap:.55em}.toolbar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{accent-color:#294686;margin-right:.28em}.toolbar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.98rem;color:#50618f;font-style:normal}.toolbar[_ngcontent-%COMP%]   .slider-container[_ngcontent-%COMP%]{width:100%;margin-top:1.2rem}.toolbar[_ngcontent-%COMP%]   .slider-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.07rem;font-weight:500;color:#2d384b}.toolbar[_ngcontent-%COMP%]   .slider-container[_ngcontent-%COMP%]   #angleSlider[_ngcontent-%COMP%]{width:100%;margin-top:.5rem;accent-color:#294686;height:3px;background:#e7edfa;border-radius:3px;cursor:pointer}.toolbar[_ngcontent-%COMP%]   .slider-container[_ngcontent-%COMP%]   #angleDisplay[_ngcontent-%COMP%]{margin-top:.3rem;font-size:.96rem;color:#197749;text-align:right;font-weight:500}.routeAttributes[_ngcontent-%COMP%]{flex:1 1 330px;min-width:260px;max-width:400px;margin-top:.5rem}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{background:#fff;padding:2rem 1.7rem 1.7rem;border-radius:14px;box-shadow:0 8px 32px #3c485333,0 2.5px 6px #20232733;display:flex;flex-direction:column}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{margin-top:.8rem;padding:.6em 0;font-size:1.1rem;font-weight:600;border-radius:8px;color:#197749;border-color:#197749;transition:background .18s,color .18s;min-width:130px}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background:#197749;color:#fff}@media (max-width: 1020px){.work-space[_ngcontent-%COMP%]{flex-direction:column;gap:2rem;align-items:stretch}.wall-container[_ngcontent-%COMP%], .toolbar[_ngcontent-%COMP%], .routeAttributes[_ngcontent-%COMP%]{max-width:100%;min-width:0;width:100%}}@media (max-width: 610px){h1[_ngcontent-%COMP%]{font-size:1.33rem;margin-top:1.3rem}.work-space[_ngcontent-%COMP%]{padding:0 .1rem}.toolbar[_ngcontent-%COMP%], .routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{padding:1.1rem .6rem}.routeAttributes[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{gap:.55rem}}"]})};export{Y as RouteBuilderPageComponent};
